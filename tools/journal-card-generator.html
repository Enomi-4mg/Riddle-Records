---
render_with_liquid: false
---
<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Journal Card Generator</title>
    <link rel="stylesheet" href="tools.css">
    <style>
        .flex-row { display: flex; gap: 10px; flex-wrap: wrap; }
        .half { flex: 1 1 260px; }
        .card-list { margin-top: 10px; }
        .card-box { border: 1px solid #ddd; border-radius: 6px; padding: 12px; margin-bottom: 12px; background: #fafafa; }
        .card-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px; }
        .badge { background: #e6f4ff; color: #005a9e; padding: 2px 8px; border-radius: 12px; font-size: 0.8rem; }
        .muted { color: #666; font-size: 0.85rem; }
        .output-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 12px; }
        .output-block { background: #f9f9f9; border: 1px solid #ddd; border-radius: 6px; padding: 10px; display: none; }
        .output-block.visible { display: block; }
        .output-block h3 { margin-top: 0; }
        .output-textarea { width: 100%; min-height: 200px; font-family: monospace; border: 1px solid #ccc; border-radius: 4px; padding: 10px; resize: vertical; background: #fff; }
        .small-hint { font-size: 0.85rem; color: #555; margin-top: 4px; }
        .pill { display: inline-block; padding: 3px 8px; border-radius: 999px; background: #eef2f7; color: #333; font-size: 0.8rem; }
        .section-title { margin-top: 24px; border-left: 4px solid #007acc; padding-left: 8px; }
        .button-row { display: flex; gap: 10px; flex-wrap: wrap; margin: 10px 0; }
        .ghost-btn { background: #f0f0f0; color: #333; border: 1px solid #ccc; }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ§© Journal Card Generator</h1>
        <p class="info">Journalã‚«ãƒ¼ãƒ‰ï¼æ¯”è¼ƒã‚«ãƒ¼ãƒ‰ã®HTMLã¨ã€gallery.ymlå‘ã‘YAMLã‚’è‡ªå‹•ç”Ÿæˆã—ã¾ã™ã€‚Lightboxã‚°ãƒ«ãƒ¼ãƒ—ã®åˆ‡ã‚Šæ›¿ãˆã‚„è¨˜äº‹è§£æã«ã‚‚å¯¾å¿œã€‚</p>

        <div class="example">
            <h4>ãƒ’ãƒ³ãƒˆ</h4>
            <ul>
                <li>Lightboxã‚°ãƒ«ãƒ¼ãƒ—ã¯ãƒ‰ãƒ­ãƒƒãƒ—ãƒ€ã‚¦ãƒ³ã§åˆ‡ã‚Šæ›¿ãˆã€‚è‡ªå‹•ãƒ©ãƒƒãƒ—å¯¾è±¡å¤–ã«ã™ã‚‹å ´åˆã¯ã€è‡ªå‰ã§&lt;a data-lightbox&gt;ä»˜ãHTMLã‚’ä½¿ã„ã¾ã™ã€‚</li>
                <li>è¨˜äº‹URLã¯ã‚¹ãƒ©ãƒƒã‚°ã‹ã‚‰æ¨å®šã—ã¾ã™ãŒã€æ‰‹å‹•ä¸Šæ›¸ãã‚‚å¯èƒ½ã§ã™ã€‚</li>
                <li>è¤‡æ•°ã‚«ãƒ¼ãƒ‰æ™‚ã®æ¯”è¼ƒãƒ©ãƒ™ãƒ«ï¼é †åºã¯ä»»æ„å…¥åŠ›ã§ã™ã€‚</li>
            </ul>
        </div>

        <h3 class="section-title">å…¨ä½“è¨­å®š</h3>
        <div class="flex-row">
            <div class="half form-group">
                <label for="layoutSelect">ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆ</label>
                <select id="layoutSelect">
                    <option value="journal-card-grid">journal-card-gridï¼ˆæ±ç”¨ï¼‰</option>
                    <option value="making-comparison-grid">making-comparison-gridï¼ˆ2åˆ—æ¯”è¼ƒï¼‰</option>
                </select>
            </div>
            <div class="half form-group">
                <label for="lightboxPreset">Lightboxã‚°ãƒ«ãƒ¼ãƒ—</label>
                <select id="lightboxPreset">
                    <option value="Journal">Journalï¼ˆæ—¢å®šï¼‰</option>
                    <option value="gallery">gallery</option>
                    <option value="making-comparison">making-comparison</option>
                    <option value="custom">ã‚«ã‚¹ã‚¿ãƒ </option>
                </select>
                <input type="text" id="customLightbox" placeholder="custom-group" style="display:none; margin-top:8px;">
                <div class="small-hint">postãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆã®è‡ªå‹•ãƒ©ãƒƒãƒ—ã¯æœªãƒ©ãƒƒãƒ—ç”»åƒã®ã¿ã‚’ data-lightbox="Journal" ã§åŒ…ã¿ã¾ã™ã€‚ã‚«ã‚¹ã‚¿ãƒ ã‚°ãƒ«ãƒ¼ãƒ—ã¯è‡ªå‰ã®&lt;a&gt;ã§å›é¿ã—ã¦ãã ã•ã„ã€‚</div>
            </div>
        </div>

        <div class="flex-row">
            <div class="half form-group">
                <label for="articleSlug">è¨˜äº‹ã‚¹ãƒ©ãƒƒã‚°ï¼ˆä¾‹: 2025-06-06ï¼‰</label>
                <input type="text" id="articleSlug" placeholder="2025-06-06">
                <div class="small-hint">/Journal/:name/ ã‚’æ¨å®šã—ã¾ã™ï¼ˆä¸Šæ›¸ãå¯ï¼‰ã€‚</div>
            </div>
            <div class="half form-group">
                <label for="articleDate">æ—¥ä»˜ (YAMLç”¨, ä»»æ„)</label>
                <input type="text" id="articleDate" placeholder="2025-06-06">
            </div>
        </div>

        <div class="flex-row">
            <div class="half form-group">
                <label for="articleUrl">article_url</label>
                <input type="text" id="articleUrl" placeholder="/Journal/2025-06-06/">
            </div>
            <div class="half form-group">
                <label for="makingUrl">making_article_url (ä»»æ„)</label>
                <input type="text" id="makingUrl" placeholder="/Journal/2025-06-06/five-apples-making/">
            </div>
        </div>

        <div class="form-group">
            <label for="comparisonGroup">comparison_group (ä»»æ„, è¤‡æ•°ã‚«ãƒ¼ãƒ‰ã§å…±æœ‰)</label>
            <input type="text" id="comparisonGroup" placeholder="five-apples">
        </div>

        <div class="card-list" id="cardList"></div>
        <div class="button-row">
            <button class="ghost-btn" onclick="addCard()">ï¼‹ ã‚«ãƒ¼ãƒ‰ã‚’è¿½åŠ </button>
            <button onclick="generateOutputs()">HTML / YAML ã‚’ç”Ÿæˆ</button>
        </div>

        <h3 class="section-title">è¨˜äº‹è§£æãƒ¢ãƒ¼ãƒ‰</h3>
        <div class="form-group">
            <label for="articleInput">è¨˜äº‹æœ¬æ–‡ã‚’è²¼ã‚Šä»˜ã‘ï¼ˆHTML/Markdownæ··åœ¨OKï¼‰</label>
            <textarea id="articleInput" placeholder="<div class=&quot;journal-card&quot;>..."></textarea>
            <div class="button-row">
                <button class="ghost-btn" onclick="analyzeArticle()">æœ¬æ–‡ã‹ã‚‰ã‚«ãƒ¼ãƒ‰ã‚’æŠ½å‡º</button>
                <button class="ghost-btn" onclick="resetCards()">åˆæœŸåŒ–</button>
            </div>
            <div class="small-hint">.journal-card / .comparison-item å†…ã® &lt;a data-lightbox&gt; ã‚„ &lt;img&gt; ã‹ã‚‰ Cloudinary IDãƒ»captionãƒ»label ã‚’æŠ½å‡ºã—ã¾ã™ã€‚</div>
        </div>

        <h3 class="section-title">å‡ºåŠ›</h3>
        <div class="output-grid">
            <div class="output-block" id="htmlBlock">
                <h3>HTML</h3>
                <textarea id="htmlOutput" class="output-textarea" readonly></textarea>
                <div class="button-row">
                    <button class="copy-btn" onclick="copyText('htmlOutput')">ğŸ“‹ ã‚³ãƒ”ãƒ¼</button>
                </div>
            </div>
            <div class="output-block" id="yamlBlock">
                <h3>YAML (gallery.ymlç”¨)</h3>
                <textarea id="yamlOutput" class="output-textarea" readonly></textarea>
                <div class="button-row">
                    <button class="copy-btn" onclick="copyText('yamlOutput')">ğŸ“‹ ã‚³ãƒ”ãƒ¼</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        let cards = [];
        let articleUrlTouched = false;

        const defaultCard = () => ({
            title: '',
            label: '',
            cloudinaryId: '',
            description: '',
            categories: '',
            comparisonLabel: '',
            comparisonOrder: '',
            thumbnail: true,
            noGalleryButton: true
        });

        const cardListEl = document.getElementById('cardList');
        const layoutSelect = document.getElementById('layoutSelect');
        const lightboxPreset = document.getElementById('lightboxPreset');
        const customLightbox = document.getElementById('customLightbox');
        const articleSlug = document.getElementById('articleSlug');
        const articleUrl = document.getElementById('articleUrl');
        const makingUrl = document.getElementById('makingUrl');
        const articleDate = document.getElementById('articleDate');
        const comparisonGroup = document.getElementById('comparisonGroup');
        const htmlBlock = document.getElementById('htmlBlock');
        const yamlBlock = document.getElementById('yamlBlock');
        const htmlOutput = document.getElementById('htmlOutput');
        const yamlOutput = document.getElementById('yamlOutput');

        function init() {
            addCard();
            lightboxPreset.addEventListener('change', handleLightboxChange);
            articleSlug.addEventListener('input', syncArticleUrl);
            articleUrl.addEventListener('input', () => { articleUrlTouched = true; });
        }

        function handleLightboxChange() {
            customLightbox.style.display = lightboxPreset.value === 'custom' ? 'block' : 'none';
        }

        function syncArticleUrl() {
            const slug = articleSlug.value.trim();
            if (!slug) return;
            if (!articleUrlTouched) {
                articleUrl.value = `/Journal/${slug}/`;
            }
            if (!comparisonGroup.value.trim()) {
                comparisonGroup.value = slug;
            }
            if (!articleDate.value.trim() && /^\d{4}-\d{2}-\d{2}$/.test(slug)) {
                articleDate.value = slug;
            }
        }

        function addCard(data = {}) {
            cards.push({ ...defaultCard(), ...data });
            renderCards();
        }

        function removeCard(index) {
            if (cards.length === 1) {
                cards[0] = defaultCard();
            } else {
                cards.splice(index, 1);
            }
            renderCards();
        }

        function updateCard(index, key, value) {
            cards[index][key] = value;
        }

        function renderCards() {
            cardListEl.innerHTML = '';
            cards.forEach((card, index) => {
                const box = document.createElement('div');
                box.className = 'card-box';
                box.innerHTML = `
                    <div class="card-header">
                        <div class="badge">Card ${index + 1}</div>
                        <button class="ghost-btn" onclick="removeCard(${index})">å‰Šé™¤</button>
                    </div>
                    <div class="form-group">
                        <label>caption (data-title / alt)</label>
                        <input type="text" value="${escapeHtml(card.title)}" oninput="updateCard(${index}, 'title', this.value)">
                    </div>
                    <div class="form-group">
                        <label>ã‚«ãƒ¼ãƒ‰ã®è¦‹å‡ºã— (h4 / comparison label)</label>
                        <input type="text" value="${escapeHtml(card.label)}" oninput="updateCard(${index}, 'label', this.value)">
                    </div>
                    <div class="form-group">
                        <label>Cloudinary ID (å¿…é ˆ, æ‹¡å¼µå­ä»˜ã)</label>
                        <input type="text" value="${escapeHtml(card.cloudinaryId)}" placeholder="music_box_pt6tr9.jpg" oninput="updateCard(${index}, 'cloudinaryId', this.value)">
                    </div>
                    <div class="form-group">
                        <label>description (YAMLç”¨, ä»»æ„)</label>
                        <input type="text" value="${escapeHtml(card.description)}" oninput="updateCard(${index}, 'description', this.value)">
                    </div>
                    <div class="form-group">
                        <label>categories (ã‚«ãƒ³ãƒåŒºåˆ‡ã‚Š, ä»»æ„)</label>
                        <input type="text" value="${escapeHtml(card.categories)}" placeholder="3DCG, Illustration" oninput="updateCard(${index}, 'categories', this.value)">
                    </div>
                    <div class="flex-row">
                        <div class="half form-group">
                            <label>comparison_label (ä»»æ„)</label>
                            <input type="text" value="${escapeHtml(card.comparisonLabel)}" oninput="updateCard(${index}, 'comparisonLabel', this.value)">
                        </div>
                        <div class="half form-group">
                            <label>comparison_order (ä»»æ„, æ•°å€¤)</label>
                            <input type="number" value="${escapeHtml(card.comparisonOrder)}" oninput="updateCard(${index}, 'comparisonOrder', this.value)">
                        </div>
                    </div>
                    <div class="form-group">
                        <label>
                            <input type="checkbox" ${card.thumbnail ? 'checked' : ''} onchange="updateCard(${index}, 'thumbnail', this.checked)">
                            ã‚µãƒ ãƒã‚¤ãƒ«å¯¾è±¡ (Journalä¸€è¦§ã§è¡¨ç¤º)
                        </label>
                    </div>
                    <div class="form-group">
                        <label>
                            <input type="checkbox" ${card.noGalleryButton ? 'checked' : ''} onchange="updateCard(${index}, 'noGalleryButton', this.checked)">
                            ã‚®ãƒ£ãƒ©ãƒªãƒ¼ã§è¦‹ã‚‹ãƒœã‚¿ãƒ³ã‚’éè¡¨ç¤º (no-gallery-button)
                        </label>
                    </div>
                `;
                cardListEl.appendChild(box);
            });
        }

        function getLightboxGroup() {
            if (lightboxPreset.value === 'custom') {
                return customLightbox.value.trim() || 'Journal';
            }
            return lightboxPreset.value;
        }

        function generateOutputs() {
            const cleanCards = cards.filter(c => c.cloudinaryId.trim());
            if (!cleanCards.length) {
                alert('å°‘ãªãã¨ã‚‚1æšã®ã‚«ãƒ¼ãƒ‰ã« Cloudinary ID ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„');
                return;
            }

            const group = getLightboxGroup();
            const layout = layoutSelect.value;
            const html = layout === 'making-comparison-grid'
                ? buildMakingComparisonHtml(cleanCards, group)
                : buildJournalGridHtml(cleanCards, group);

            const yaml = buildYaml(cleanCards, {
                articleUrl: articleUrl.value.trim(),
                makingUrl: makingUrl.value.trim(),
                date: articleDate.value.trim(),
                comparisonGroup: comparisonGroup.value.trim()
            });

            htmlOutput.value = html;
            yamlOutput.value = yaml;
            htmlBlock.classList.add('visible');
            yamlBlock.classList.add('visible');
        }

        function buildJournalGridHtml(cardData, group) {
            const inner = cardData.map(card => {
                const caption = card.title || card.label || '';
                const label = card.label || card.title || '';
                const cld = card.cloudinaryId.trim();
                                const blockClass = card.noGalleryButton ? ' no-gallery-button' : '';
                                return `  <div class="journal-card${blockClass}">
    <a href="{{ site.cloudinary_url }}/w_1920,q_auto,f_auto/v1/${escapeHtml(cld)}" data-lightbox="${escapeHtml(group)}" data-title="${escapeHtml(caption)}">
      <img src="{{ site.cloudinary_url }}/w_300,h_300,c_fill,q_auto,f_auto/v1/${escapeHtml(cld)}" alt="${escapeHtml(caption)}">
    </a>
    <div class="journal-card-info">
      <h4>${escapeHtml(label)}</h4>
    </div>
  </div>`;
            }).join('\n');
            return `<div class="journal-card-grid">
${inner}
</div>`;
        }

        function buildMakingComparisonHtml(cardData, group) {
            const inner = cardData.map(card => {
                const caption = card.title || card.label || '';
                const label = card.label || card.comparisonLabel || caption;
                const cld = card.cloudinaryId.trim();
                const labelLine = label ? `\n    <p class="comparison-label">${escapeHtml(label)}</p>` : '';
                                const blockClass = card.noGalleryButton ? ' no-gallery-button' : '';
                                return `  <div class="comparison-item${blockClass}">
    <a href="{{ site.cloudinary_url }}/w_1920,q_auto,f_auto/v1/${escapeHtml(cld)}" data-lightbox="${escapeHtml(group)}" data-title="${escapeHtml(caption)}">
      <img src="{{ site.cloudinary_url }}/w_300,h_300,c_fill,q_auto,f_auto/v1/${escapeHtml(cld)}" alt="${escapeHtml(caption)}">
    </a>${labelLine}
  </div>`;
            }).join('\n');
            return `<div class="making-comparison-grid">
${inner}
</div>`;
        }

        function buildYaml(cardData, meta) {
            const blocks = cardData.map((card, idx) => {
                const lines = [];
                const title = card.title || card.label || `Card ${idx + 1}`;
                lines.push(`- title: "${yamlEscape(title)}"`);
                if (meta.date) lines.push(`  date: ${meta.date}`);
                lines.push(`  cloudinary_id: "${yamlEscape(card.cloudinaryId.trim())}"`);
                if (card.description) lines.push(`  description: "${yamlEscape(card.description)}"`);
                if (card.categories) {
                    const cats = card.categories.split(',').map(s => s.trim()).filter(Boolean);
                    lines.push(`  categories: [${cats.map(c => `"${yamlEscape(c)}"`).join(', ')}]`);
                }
                if (meta.articleUrl) lines.push(`  article_url: "${yamlEscape(meta.articleUrl)}"`);
                if (meta.makingUrl) lines.push(`  making_article_url: "${yamlEscape(meta.makingUrl)}"`);
                if (meta.comparisonGroup) lines.push(`  comparison_group: "${yamlEscape(meta.comparisonGroup)}"`);
                const compLabel = card.comparisonLabel || card.label;
                if (compLabel) lines.push(`  comparison_label: "${yamlEscape(compLabel)}"`);
                if (card.comparisonOrder) lines.push(`  comparison_order: ${card.comparisonOrder}`);
                if (card.thumbnail) lines.push(`  thumbnail: true`);
                return lines.join('\n');
            });
            return blocks.join('\n');
        }

        function copyText(id) {
            const text = document.getElementById(id).value;
            navigator.clipboard.writeText(text).then(() => alert('ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸ')).catch(() => alert('ã‚³ãƒ”ãƒ¼ã«å¤±æ•—ã—ã¾ã—ãŸ'));
        }

        function escapeHtml(str) {
            const map = {"&": "&amp;", "<": "&lt;", ">": "&gt;", "\"": "&quot;", "'": "&#39;"};
            return (str || '').replace(/[&<>"']/g, ch => map[ch]);
        }

        function yamlEscape(str) {
            return (str || '').replace(/"/g, '\\"');
        }

        function extractCloudinaryId(url) {
            if (!url) return '';
            const regex = /\/image\/upload\/(?:[^/]*\/)*([^?/\s]+)(?:\?.*)?$/;
            const match = url.match(regex);
            return match ? match[1] : '';
        }

        function analyzeArticle() {
            const raw = document.getElementById('articleInput').value;
            if (!raw.trim()) {
                alert('è¨˜äº‹æœ¬æ–‡ã‚’è²¼ã‚Šä»˜ã‘ã¦ãã ã•ã„');
                return;
            }
            const parser = new DOMParser();
            const doc = parser.parseFromString(raw, 'text/html');
            const nodes = Array.from(doc.querySelectorAll('.journal-card, .comparison-item'));

            if (!nodes.length) {
                alert('ã‚«ãƒ¼ãƒ‰è¦ç´ ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã§ã—ãŸ (.journal-card / .comparison-item)');
                return;
            }

            const parsed = nodes.map((node, idx) => {
                const anchor = node.querySelector('a');
                const img = node.querySelector('img');
                const caption = (anchor && anchor.getAttribute('data-title')) || (img && img.alt) || '';
                const labelNode = node.querySelector('h4') || node.querySelector('.comparison-label');
                const label = labelNode ? labelNode.textContent.trim() : caption;
                const lightbox = anchor ? anchor.getAttribute('data-lightbox') || '' : '';
                const cld = extractCloudinaryId(anchor ? anchor.href : img ? img.src : '');
                const hasThumbnailAttr = node.dataset.thumbnail !== undefined;
                const noGalleryButton = node.classList.contains('no-gallery-button') || (img && img.classList.contains('no-gallery-button'));
                return {
                    title: caption,
                    label: label,
                    cloudinaryId: cld,
                    description: '',
                    categories: '',
                    comparisonLabel: label,
                    comparisonOrder: idx + 1,
                    lightbox,
                    thumbnail: hasThumbnailAttr || true,
                    noGalleryButton: noGalleryButton
                };
            }).filter(c => c.cloudinaryId);

            if (!parsed.length) {
                alert('Cloudinary IDã‚’æŒã¤ã‚«ãƒ¼ãƒ‰ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã§ã—ãŸ');
                return;
            }

            const firstLb = parsed.find(p => p.lightbox && p.lightbox !== 'Journal');
            if (firstLb) {
                lightboxPreset.value = 'custom';
                handleLightboxChange();
                customLightbox.value = firstLb.lightbox;
            }

            cards = parsed;
            renderCards();
            generateOutputs();
        }

        function resetCards() {
            cards = [defaultCard()];
            renderCards();
            htmlOutput.value = '';
            yamlOutput.value = '';
            htmlBlock.classList.remove('visible');
            yamlBlock.classList.remove('visible');
        }

        init();
    </script>
</body>
</html>
